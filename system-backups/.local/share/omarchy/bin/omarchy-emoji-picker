#!/usr/bin/env bash
# Emoji Picker using fuzzel â€” Fixed 2025 edition

EMOJI_FILE="$HOME/.cache/emojis.txt"

mkdir -p "$(dirname "$EMOJI_FILE")"

# Ensure the emoji file exists
if [ ! -s "$EMOJI_FILE" ]; then
  echo "Emoji list not found at $EMOJI_FILE. Please check the file and try again."
  exit 1
fi

get_emojis() {
  # Read the emoji file and print both the emoji and its name (separated by a space)
  cat "$EMOJI_FILE"
}

selected_line=$(get_emojis | fuzzel --dmenu --prompt="ðŸ” " --placeholder="Search emojis...")

if [ -n "$selected_line" ]; then
  # Extract the emoji (the first word in the line) to copy it
  selected_emoji=$(echo "$selected_line" | awk '{print $1}')

  # Copy the emoji to the clipboard using the appropriate tool
  if command -v wl-copy >/dev/null 2>&1; then
    echo -n "$selected_emoji" | wl-copy
  elif command -v pbcopy >/dev/null 2>&1; then
    echo -n "$selected_emoji" | pbcopy
  fi

  # Notify the user about the copied emoji
  if command -v notify-send >/dev/null 2>&1; then
    notify-send "Emoji Picker" "Copied $selected_emoji to clipboard"
  fi
fi
